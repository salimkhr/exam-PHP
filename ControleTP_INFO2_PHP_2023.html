<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>Contrôle de TP</title>
</head>
<body>
<div class="container">
    <header class="m-b-20">
        <div class="row">
            <h1 class="text-center">Contrôle de TP 2023-2024</h1>
        </div>
        <div class="row">
            <div class="col-4">
                <p><strong>Département Informatique</strong></p>
                <p>BUT Info 2 - 2022/2023</p>
            </div>
            <div class="col-4 offset-4">
                <p class="text-end"><strong>Applications Web</strong></p>
                <p class="text-end"> Khraimeche Salim.</p>
            </div>
        </div>
    </header>
    <main>
        <!-- présentation -->
        <section class="row">
            <article class="col-12">
                <h2>Consignes de rendu des travaux : </h2>
                <p>
                    A l'issue du contrôle, vous remettrez tous vos fichiers de travail
                    (dont la structuration sous forme de dossiers est précisée ci-dessous) dans
                    votre répertoire d'examen <strong>TP/dossier_exam</strong> préalablement vidé de son
                    éventuel ancien contenu. A la fin de la séance nous récupérerons automatiquement le contenu complet de votre dossier d’examen.
                </p>
                <p>
                    Vos fichiers devront être répartis dans plusieurs dossiers que vous archiverez (un dossier => une archive <strong>zip</strong>).<br/>
                    Chaque dossier devra comporter tous les fichiers nécessaires à
                    l'exécution de cette/ces partie(s), indépendamment des autres parties (même si
                    certains fichiers devront être copiés à l'identique). Les dossiers sont les suivants :
                <p>
            </article>
            <article class="col-6">
                <span class="h5">Parties A et B : formulaire de création et affichage</span>
                <ul>
                    <li>editIngredient.php</li>
                    <li>Ingredient.inc.php</li>
                    <li>TODO METTRE LE NOM DES FICHIERS</li>
                </ul>
            </article>
            <article class="col-6">
                <span class="h5">Partie C : utilisation d'une base de données</span>
                <ul>
                    <li>TODO METTRE LE NOM DES FICHIERS</li>
                    <li>TODO METTRE LE NOM DES FICHIERS</li>
                    <li>TODO METTRE LE NOM DES FICHIERS</li>
                </ul>

                Avant de rendre votre projet, merci de modifier la connexion a la base de données :
                <ul>
                    <li>URL : 127.0.0.1</li>
                    <li>Login : pizza</li>
                    <li>Mot de passe : Hawaienne</li>
                </ul>
            </article>
            <article class="col-12">
                <div class="row">
                    <div class="col-2">
                        <span class="h4">Barème :</span>
                        <ul>
                            <li>partie A : (8 points)</li>
                            <li>partie B : (6 points)</li>
                            <li>partie C : (6 points)</li>
                        </ul>
                    </div>
                    <div class="col-10">
                        <p class="mt-5 mb-0">
                            La notation prendra en compte le respect du nom des classes et des fonctions ainsi que le respect des structure vu en cours.</p>
                        <em>Le css ne sera pas pris en compte dans la notation</em>
                    </div>
                </div>
            </article>
            <article class="col-12">
                <span class="h4">Résumé du sujet : </span>
                <p>L'objectif de cet exercice est de mettre en place un système de gestion des ingrédients pour des recettes de pizza à l'aide d'un formulaire de saisie.</p>
                <p>Dans la partie A, les ingrédients (un ou plusieurs) seront gérés et stockés sous forme d'objets instances d'une classe <strong>Ingredient</strong> définie dans le fichier <em>ingredient.inc.php</em>. Cette classe sera responsable de stocker toutes les informations liées à un ingrédient, telles que son nom, sa quantité, et d'autres caractéristiques.</p>
                <p>La partie B du projet consiste à développer des fonctionnalités pour créer des recettes de pizza en utilisant les ingrédients gérés dans la partie A. Les étudiants devront créer une page d'édition <em>editPizza.php</em> pour permettre la création de nouvelles recettes de pizza en ajoutant les ingrédients appropriés</p>
                <p>Enfin, dans la partie C, les étudiants devront intégrer une base de données PostgreSQL pour stocker de manière permanente les recettes de pizza ainsi que les détails des ingrédients. Cette base de données permettra une gestion plus efficace des recettes de pizza et de leurs composants.</p>
                <div class="col-12">
                    <p>
                        Les différentes pages à réaliser comporteront la structure déjà vue en TP en trois parties
                        (fonctions PHP) : <code>entete()</code>, <code>contenu()</code>, et <code>pied()</code>. Les éléments d'entête
                        et pied de page seront disponibles grace à deux fonctions présentes
                        dans le fichier de fonctions auxiliaires <em>fctAux.inc.php </em>fourni dans cette archive :
                        <a href="src.zip">scr.zip</a> (qui comporte aussi l'image du bandeau et la feuille de style <strong>site.css</strong>).
                    </p>
                </div>
            </article>
        </section>

        <!-- Partie A -->
        <section class="row">
            <article class="col-12">
                <h2>Partie A : <span class="h3">Formulaire de création (8 points).</span></h2>
                <p>
                    Dans cette partie, il s'agit de modifier le script <em>editIngredient.php</em> qui génère et affiche un formulaire de création d'un ingrédient.
                </p>
                <p>Le formulaire est constitué des champs suivants :</p>
                <div class="ms-5">
                    <dl>
                        <dt>Nom de l'ingrédient :</dt>
                        <dd>un champ de saisie libre saisi obligatoirement</dd>
                        <dt>Quantité :</dt>
                        <dd>un champ de saisie autorisant uniquement les nombres</dd>
                        <dt>Unité :</dt>
                        <dd>une liste avec les options "feuilles","gousses","grammes","tasse" et une option vide sélectionnée par défaut</dd>
                    </dl>
                    <p>afin d'avoir un meilleur visuel, vous ajouter au <code>input</code> et <code>select</code> la class <em>"form-control"</em> et la class <em>"form-label"</em> au <code>label</code>
                </div>
                <p>
                    On ajoutera enfin deux boutons <strong>Valider</strong> et <strong>Annuler</strong> qui permettront respectivement de soumettre ou de remettre à zéro les champs du formulaire.
                </p>
                <p>
                    <strong>1/</strong> Créez une classe PHP <strong>Ingredient</strong>, semblable à la classe Client vue en TP, dans le fichier <em>ingredient.inc.php</em> qui possède les attributs suivants décrits précédemment :
                    <pre>
                        <code>
string $name
int $quantity
?string $unit
                        </code>
                    </pre>
                    <em>Ces attributs permettront de stocker les valeurs des champs du formulaire sous forme d'objets, instances de cette classe, après validation du formulaire.</em>
                </p>
                <p>
                    <strong>2/</strong> En suivant les recommandations du TP6 sur les formulaires et leur validation, réalisez le script <em>editIngredient.php</em> qui crée le formulaire de saisie d'un ingrédient en respectant les contraintes suivantes et en utilisant les différents types de balises input permises en HTML 5 :
                    <ul>
                        <li>le champs 'Nom de l'ingrédient' du formulaire est obligatoire.</li>
                        <li>Le champ de quantité doit accepter uniquement des valeurs numériques.</li>
                    </ul>
                </p>

                <p>
                    <strong>3/</strong> Le script doit donc créer une nouvelle instance de la classe <strong>Ingredient</strong> définie précédemment à partir des valeurs renvoyées par le formulaire, en passant en paramètre du constructeur les valeurs des champs du formulaire préalablement nettoyées (cf. TP6).
                </p>

                <p>
                    <strong>4/</strong> Modifier le script <em>editIngredient.php</em> pour faire en sorte que, une fois les données du formulaire de saisie validées, il donne en réponse une page avec le descriptif de l'ingrédient qui vient juste d'être saisi.
                </p>
                <p>
                    Vous compléterez pour se faire la méthode <code>__toString()</code> de la classe <code>Ingredient</code> afin qu'elle renvoie une seule chaîne de caractères en code HTML qui affiche l'ingrédient tout juste créé. Ainsi on affichera :
                <ul>
                    <li>Le nom de l'ingrédient dans une balise <code>h3</code></li>
                    <li>La quantité et l'unité concaténée, dans une balise <code>h4</code>.</li>
                    <li>On mettra l'ensemble de ces balises pour un même ingrédient dans une balise <code>article</code>.</li>
                </ul>
            </article>
        </section>

        <!-- Partie B -->
        <section class="row">
            <article class="col-12">
                <h2>Partie B : <span class="h3">Affichage des pizzas (6 points).</span></h2>
                <p>
                    Dans cette partie, il s'agit de Modifier le script consultPizza.php qui affiche la liste complète des ingrédients créés pendant le temps d'une session utilisateur.
                <p>
                    Ce script doit afficher tous les ingrédients créés jusque là.
                    En revanche, la question principale ici est de pouvoir stocker successivement les objets <code>ingrédient</code> créés via le formulaire géré par le script <em>editIngredient.php</em> sans utiliser de base de données pour l'instant. Pour réaliser cela, on va utiliser les sessions qui permettent de conserver des informations entre des pages successives de script.
                    La procédure est la suivante : dans le script <em>editIngredient.php</em>, on ouvre une session ou on récupère la session courante pour y stocker un tableau tous les objets <code>Ingredient</code> créés jusqu'ici durant la session.
                </p>

                <p>
                    Rappel de ce qui a été vu en TP : pour stocker un objet dans une session, il est nécessaire de le sérialiser (c'est-à-dire en faire une grande chaîne de caractères) grâce à la fonction serialize(Object).
                    Inversement lorsque l'on devra extraire les ingredient dans le script consultPizza.php, il faudra désérialiser les objets de type Message présents dans le tableau stocké dans la session courante, grâce à la fonction unserialize() qui attend une chaine de caractères.
                    De même pour ajouter dynamiquement une nouvelle valeur x à un tableau php $tab, on peut écrire $tab[]=x.

                    pour pouvoir sérialiser et désérialiser notre objet, nous allons rajouter le code suivant a notre class <code>Ingrediant</code>. cette Méthode permet de garder "private" les attributs de la class
                <pre>
                    <code>
public function __serialize(): array
{
  return [
    'name' => $this->name,
    'quantity' => $this->quantity,
    'unit' => $this->unit,
  ];
}

public function __unserialize(array $data): void
{
  $this->name = $data['name'];
  $this->quantity = $data['quantity'];
  $this->unit = $data['unit'];
}
                    </code>
                </pre>
                </p>

                <p>
                    <strong>1/</strong> Compléter le script <em>editIngredient.php</em> de façon à pouvoir stocker tous les objets de type <code>Ingrediant</code> créés dans la session courante. la clef de la session sera 'ingredient'
                </p>

                <p>
                    <strong>2/</strong> Modifier le script <em>consultPizza.php</em> qui permet de visualiser les pizzas aves les ingredients stockés dans la session courante comme décrit précédemment.
                    Le script <em>consultPizza.php</em> crée une instance de l'objet <code>Pizza</code> possedant la méthode <code>addIngredient()</code>
                    utiliser cette méthode pour ajouter les ingrediants présent en session a la pizza.

                </p>
            </article>
        </section>

        <!-- Partie C -->
        <section class="row">
            <article class="col-12">
                <h2>Partie C : <span class="h3">Utilisation d'une base de données (6 points)</span></h2>
                <p>
                    Nous allons maintenant plutôt pérenniser nos ingredients en les ajoutant non pas dans une session, mais dans une table <em>Ingredient</em> que vous allez créer dans votre base de données PotgreSQL habituelle. Un script SQL <a href="pizza.sql" target="_blank">pizza.sql</a> va créer les tables Ingredient et Pizza.
                </p>
                <br>
                <div>
                    <ul>
                        <li>1/ Exécuter le script SQL de création des tables <strong>Ingredient, Pizza et Category</strong> dans votre base Postgresql. Vérifier que vos tables sont bien créées avec des Pizzas. </li>
                        <li>2/ Rajouter un attribut <code>private int $idPizza;</code> a la classe <strong>Ingredient</strong>.
                        <li>3/ Adapter la classe <strong>DB</strong>, déjà vue en TP définie dans le fichier <em>DB.inc.php</em> pour, en plus des méthodes de traitants les pizzas, y ajouter trois méthodes :
                            <ul>
                                <li>Une méthode <strong>getIngredients() </strong>pour récupérer les tuples de la table <strong>Ingredient</strong> sous forme d'un tableau d'objets de type <strong>Ingredient</strong>, </li>
                                <li>Une méthode <strong>getIngredientsByPizza(int $idPizza) </strong>pour récupérer les tuples de la table <strong>Ingredient</strong> qui constitue la pizza passée en paramètre.</li>
                                <li>Une méthode <strong>insertIngredient() </strong>pour insérer un nouveau tuple dans la table <strong>Ingredient</strong>. Cette méthode doit prendre en paramètre une valeur pour chaque attribut de la table <strong>Ingredient</strong></li>
                            </ul>
                        </li>
                        <li>4/ Modifier le script de la page <em>consultPizza.php</em>&nbsp;pour récupérer les ingredients dans la table <strong>Ingrediant</strong> de la base de données (via la méthode <strong>getIngredientsByPizza()</strong> de la classe DB et non plus dans la session.</li>
                        <li>5/ Modifier également le script <em>editIngredient.php</em> pour insérer les données validées du formulaire dans la table <strong>Ingredient</strong> de votre base de données en utilisant la méthode <strong>insertIngredient()</strong> de la classe DB. La session ne sera donc plus utilisée. Vous pourrez récupérer le paramètre <strong>idPizza</strong> via la méthode GET</li>
                    </ul>
                </div>
            </article>
        </section>
    </main>
</div>
<script src="js/bootstrap.bundle.min.js"></script>
</body>
</html>
